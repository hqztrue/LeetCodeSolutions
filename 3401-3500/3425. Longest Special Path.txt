dfs, maintain a stack for each type. O(n).

