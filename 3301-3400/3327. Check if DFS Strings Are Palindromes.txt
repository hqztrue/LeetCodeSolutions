dfs+manacher/hashing. O(n).

