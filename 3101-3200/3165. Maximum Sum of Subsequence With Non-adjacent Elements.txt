segment tree. O(q log n).

